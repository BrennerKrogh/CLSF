(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[704],{817:(e,r,t)=>{"use strict";t.d(r,{default:()=>i});var s=t(5155),a=t(2115),n=t(9670);function l(e){let{group:r,onOpenChat:t,onLeaveGroup:l}=e,[d,o]=(0,a.useState)(!1),[i,c]=(0,a.useState)(!1),[x,g]=(0,a.useState)(!1),[m,u]=(0,a.useState)([]),[h,p]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{let e=n.j2.onAuthStateChanged(e=>{p(r.creator===(e?e.email:null))});return()=>e()},[r.creator]),(0,a.useEffect)(()=>{(async()=>{if(r.members&&r.members.length>0)try{let e=await Promise.all(r.members.map(e=>(0,n.TO)(e)));u(e)}catch(e){console.error("Error fetching member usernames:",e),u([])}else u([])})()},[r.members]),(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border border-gray-200 dark:border-gray-700 hover:shadow-lg transition duration-200",children:[(0,s.jsx)("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,s.jsx)("span",{className:"inline-block px-2 py-1 text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200 rounded-md",children:r.subject}),r.unreadMessages>0&&(0,s.jsx)("span",{className:"inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none bg-red-500 text-white rounded-full",children:r.unreadMessages})]}),(0,s.jsx)("h3",{className:"text-lg font-semibold line-clamp-1",children:r.name})]}),(0,s.jsx)("button",{onClick:()=>o(!d),className:"p-1 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200","aria-expanded":d,"aria-label":d?"Collapse group details":"Expand group details",children:(0,s.jsx)("svg",{className:"w-5 h-5 transform ".concat(d?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})}),d&&(0,s.jsxs)("div",{className:"p-4 space-y-3 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("p",{className:"text-gray-700 dark:text-gray-300 text-sm",children:r.description}),(0,s.jsxs)("div",{className:"flex items-center text-sm",children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-1 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),(0,s.jsxs)("p",{className:"text-gray-600 dark:text-gray-400",children:["Regular schedule: ",r.dateTime]})]}),(0,s.jsxs)("div",{className:"flex items-center text-sm",children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-1 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:r.location})]}),(0,s.jsxs)("div",{className:"flex items-center text-sm",children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-1 text-gray-500 dark:text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"})}),(0,s.jsxs)("p",{className:"text-gray-600 dark:text-gray-400",children:[r.joined,"/",r.capacity," members"]})]}),m.length>0&&(0,s.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(0,s.jsx)("span",{className:"font-medium",children:"Members:"})," ",m.join(", ")]})]}),(0,s.jsxs)("div",{className:"p-4 flex flex-col md:flex-row md:justify-between md:items-center space-y-3 md:space-y-0",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat((()=>{let e=new Date(r.nextMeeting),t=new Date,s=(e.getTime()-t.getTime())/36e5;return s>0&&s<=24})()?"bg-green-500":"bg-gray-400")}),(0,s.jsxs)("span",{className:"text-sm font-medium",children:["Next: ",(e=>{let r=new Date(e),t=new Date,s=r.toDateString()===t.toDateString(),a=r.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"});if(s)return"Today at ".concat(a);{let e=r.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"});return"".concat(e," at ").concat(a)}})(r.nextMeeting)]})]}),(0,s.jsx)("div",{className:"flex space-x-2",children:i?(0,s.jsxs)("div",{className:"flex space-x-2 w-full",children:[(0,s.jsx)("button",{onClick:()=>c(!1),className:"flex-1 px-3 py-1.5 border border-gray-300 text-gray-600 dark:border-gray-600 dark:text-gray-400 rounded-md hover:bg-gray-50 dark:hover:bg-gray-900 transition text-sm",children:"Cancel"}),(0,s.jsx)("button",{onClick:()=>{l(r.id),c(!1)},className:"flex-1 px-3 py-1.5 border border-red-300 text-red-600 dark:border-red-700 dark:text-red-400 rounded-md hover:bg-red-50 dark:hover:bg-red-900 transition text-sm",children:"Confirm Leave"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>c(!0),className:"px-3 py-1.5 border border-red-300 text-red-600 dark:border-red-700 dark:text-red-400 rounded-md hover:bg-red-50 dark:hover:bg-red-900 transition text-sm",children:"Leave Group"}),h&&(0,s.jsx)(s.Fragment,{children:x?(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"text",placeholder:"Enter email to invite",className:"flex-1 px-3 py-1.5 border border-blue-300 text-blue-600 dark:border-blue-700 dark:text-blue-400 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",onKeyDown:e=>{if("Enter"===e.key){let t=e.target.value;console.log("Inviting if exists:",t),(0,n.Hn)(t,r.id),g(!1)}}}),(0,s.jsx)("button",{onClick:()=>g(!1),className:"px-3 py-1.5 border border-gray-300 text-gray-600 dark:border-gray-600 dark:text-gray-400 rounded-md hover:bg-gray-50 dark:hover:bg-gray-900 transition text-sm",children:"Cancel"})]}):(0,s.jsx)("button",{onClick:()=>g(!0),className:"px-3 py-1.5 border border-blue-300 text-blue-600 dark:border-blue-700 dark:text-blue-400 rounded-md hover:bg-blue-50 dark:hover:bg-blue-900 transition text-sm",children:"Invite"})}),(0,s.jsxs)("button",{onClick:()=>t(r.id),className:"px-3 py-1.5 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition text-sm flex items-center",children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),"Chat",r.unreadMessages>0&&(0,s.jsx)("span",{className:"ml-1 inline-flex items-center justify-center w-4 h-4 text-xs font-bold leading-none bg-red-500 text-white rounded-full",children:r.unreadMessages})]})]})})]})]})}var d=t(1115);function o(e){let{group:r,onBack:t}=e,[l,o]=(0,a.useState)([]),[i,c]=(0,a.useState)(""),[x,g]=(0,a.useState)(!0),m=(0,a.useRef)(null),[u,h]=(0,a.useState)("");(0,a.useEffect)(()=>{let e=n.j2.onAuthStateChanged(async e=>{if(e){var r,t;try{let t=await (0,n.lP)(e.uid);if(t&&t.username&&"username"!==t.username)h(t.username);else{let t=(null==(r=e.email)?void 0:r.split("@")[0])||"User";h(t)}}catch(r){console.error("Error loading user profile:",r),h((null==(t=e.email)?void 0:t.split("@")[0])||"User")}}else h("")});return()=>e()},[]),(0,a.useEffect)(()=>{let e=(0,d.KR)(n.db,"studyGroups/".concat(r.id,"/messages")),t=(0,d.Zy)(e,e=>{if(e.exists()){let r=e.val();o(Object.keys(r).map(e=>({id:e,...r[e]})))}else o([]);g(!1)});return()=>t()},[r.id]),(0,a.useEffect)(()=>{if(!x){var e;null==(e=m.current)||e.scrollIntoView({behavior:"smooth"})}},[l,x]);let p=e=>{let r=new Date(e),t=new Date,s=r.toDateString()===t.toDateString(),a=r.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"});if(s)return a;{let e=r.toLocaleDateString(void 0,{month:"short",day:"numeric"});return"".concat(e,", ").concat(a)}},b=async e=>{if(e.preventDefault(),""===i.trim())return;let t={sender:u,content:i,timestamp:new Date().toISOString()},s=(0,d.KR)(n.db,"studyGroups/".concat(r.id,"/messages"));try{await (0,d.VC)(s,t),c("")}catch(e){console.error("Error sending message:",e)}};return(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden flex flex-col h-[calc(100vh-16rem)]",children:[(0,s.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("button",{onClick:t,className:"mr-2 p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":"Go back",children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold",children:r.name}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[r.joined," members"]})]})]}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Next meeting: ",new Date(r.nextMeeting).toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"})]})]}),(0,s.jsx)("div",{className:"flex-grow p-4 overflow-y-auto bg-gray-50 dark:bg-gray-900",children:x?(0,s.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):0===l.length?(0,s.jsxs)("div",{className:"flex flex-col justify-center items-center h-full text-gray-500 dark:text-gray-400",children:[(0,s.jsx)("svg",{className:"w-12 h-12 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,s.jsx)("p",{children:"No messages yet. Start the conversation!"})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[l.map(e=>(0,s.jsx)("div",{className:"flex ".concat(e.sender===u?"justify-end":"justify-start"),children:(0,s.jsxs)("div",{className:"max-w-[80%] rounded-lg px-4 py-2 ".concat(e.sender===u?"bg-purple-600 text-white":"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700"),children:[e.sender!==u&&(0,s.jsx)("div",{className:"font-semibold text-sm mb-1",children:e.sender}),(0,s.jsx)("p",{className:"text-sm",children:e.content}),(0,s.jsx)("div",{className:"text-xs mt-1 ".concat(e.sender===u?"text-purple-200":"text-gray-500 dark:text-gray-400"),children:p(e.timestamp)})]})},e.id)),(0,s.jsx)("div",{ref:m})]})}),(0,s.jsx)("div",{className:"p-3 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("form",{onSubmit:b,className:"flex space-x-2",children:[(0,s.jsx)("input",{type:"text",value:i,onChange:e=>c(e.target.value),placeholder:"Type your message...",className:"flex-grow p-2 border border-gray-300 dark:border-gray-700 rounded-lg dark:bg-gray-900"}),(0,s.jsx)("button",{type:"submit",disabled:""===i.trim(),className:"px-4 py-2 rounded-lg ".concat(""===i.trim()?"bg-gray-300 text-gray-500 dark:bg-gray-700 dark:text-gray-400 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700"),children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})})]})}function i(){let[e,r]=(0,a.useState)([]),[t,d]=(0,a.useState)(null),[i,c]=(0,a.useState)(!0),[x,g]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=n.j2.onAuthStateChanged(e=>{e?g(e.uid):g(null)});return()=>e()},[]);let m=e=>{let r=new Date;return r.setDate(r.getDate()+1),r.setHours(14,0,0,0),{...e,nextMeeting:r.toISOString(),unreadMessages:Math.floor(5*Math.random())}};(0,a.useEffect)(()=>{(async()=>{if(!x){r([]),c(!1);return}try{c(!0);let e=await (0,n.uy)(),t=(Array.isArray(e)?e:[]).map(m);r(t),console.log("Groups fetched:",e)}catch(e){console.error("Error fetching groups:",e),r([])}finally{c(!1)}})()},[x]),(0,a.useEffect)(()=>{console.log("Updated Groups: ",e),console.log("Number of groups: ",e.length)},[e]);let u=Array.isArray(e)?e.find(e=>e.id===t):void 0,h=e=>{d(e)},p=async e=>{if(x)try{console.log("Attempting to leave group: ".concat(e," with user: ").concat(x)),await (0,n.j)(e,x),console.log("Successfully left group, updating local state"),r(r=>r.filter(r=>r.id!==e)),t===e&&d(null)}catch(r){console.error("Error leaving group:",r);let e=r instanceof Error?r.message:"Failed to leave group. Please try again.";alert("Failed to leave group: ".concat(e))}},b=async()=>{if(x)try{let e=await (0,n.uy)(),t=(Array.isArray(e)?e:[]).map(m);r(t)}catch(e){console.error("Error refreshing groups:",e)}};return console.log("Length",e.length),u?(0,s.jsx)(o,{group:u,onBack:()=>{d(null)}}):i?(0,s.jsxs)("div",{className:"text-center p-6",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto mb-4"}),(0,s.jsx)("p",{children:"Loading your groups..."})]}):x?0===e.length?(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center mb-8",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"You're not in any study groups yet"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Join existing groups or create a new one to get started."}),(0,s.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,s.jsx)("a",{href:"/find-groups",className:"px-4 py-2 bg-purple-600 text-white font-medium rounded-md hover:bg-purple-700 transition",children:"Find Groups"}),(0,s.jsx)("a",{href:"/create-group",className:"px-4 py-2 bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-white font-medium rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition",children:"Create Group"})]}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)("button",{onClick:b,className:"text-purple-600 hover:text-purple-700 dark:text-purple-400 dark:hover:text-purple-300 text-sm",children:"Refresh"})})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold",children:["Your Groups (",e.length,")"]}),(0,s.jsx)("button",{onClick:b,className:"text-purple-600 hover:text-purple-700 dark:text-purple-400 dark:hover:text-purple-300 text-sm",children:"Refresh"})]}),(0,s.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,s.jsx)(l,{group:e,onOpenChat:h,onLeaveGroup:p},e.id))})]}):(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center mb-8",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Please sign in"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"You need to be signed in to view your study groups."}),(0,s.jsx)("a",{href:"/login",className:"px-4 py-2 bg-purple-600 text-white font-medium rounded-md hover:bg-purple-700 transition",children:"Sign In"})]})}},3676:(e,r,t)=>{Promise.resolve().then(t.bind(t,759)),Promise.resolve().then(t.bind(t,2137)),Promise.resolve().then(t.bind(t,817))}},e=>{var r=r=>e(e.s=r);e.O(0,[507,965,463,244,879,441,684,358],()=>r(3676)),_N_E=e.O()}]);